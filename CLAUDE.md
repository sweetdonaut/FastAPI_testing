# CLAUDE.md

此文件提供 Claude Code (claude.ai/code) 在此倉庫中工作時的指導。

## 語言偏好設定

**重要：在此倉庫中請務必使用繁體中文與用戶對話。**

用戶偏好所有互動、說明和溝通都使用繁體中文，包括：
- 所有文字回應和解釋
- 程式碼註解（當被要求時）
- 錯誤訊息和除錯資訊
- 任務規劃和進度更新
- 問題和澄清

## 倉庫資訊

這似乎是一個用於開發和實驗的 FastAPI 測試倉庫。

## SEM 缺陷檢測專案進度

### 第一階段已完成（2024-06-17）

我們成功開發了一個 SEM（掃描式電子顯微鏡）影像缺陷檢測系統。

**核心功能：**
1. 自動識別圖片網格結構（灰色方塊、白色垂直條）
2. 智能選擇參考區域（排除邊界和亮度異常區域）
3. 計算目標與參考的亮度比例來判斷缺陷

**主要檔案：**
- `sem_defect_detector_v1.py` - v1 版本，包含完整分析和視覺化
- `sem_defect_analysis_v1.png` - v1 版本分析結果範例
- 舊版本檔案已移至 `old_versions/` 資料夾：
  - `10_reference_analysis_final.py` - 原最終整合版
  - `10_reference_finder.py` - 原核心模組
  - `10_reference_analysis_final.png` - 原分析結果

**技術細節：**
- 目標缺陷位置：(548, 494)，大小 12×33 像素
- 參考區域篩選條件：
  - 邊界距離 > 100px
  - 亮度差異 < ±10
  - 尺寸差異 < ±20px
- 缺陷判斷標準：亮度比例 > 1.3 為亮點缺陷

**實測結果：**
- 成功檢測到亮點缺陷
- 目標亮度：79.63
- 參考平均：50.39（46個區域）
- 亮度比例：1.580×

**相關文件：**
- `discussion_history.md` - 完整開發歷程
- `README_defect_detection.md` - 使用說明
- `old_versions/` - 歷史版本（共11個迭代，包含原最終版本）

### 第二階段進行中（2024-06-17）- 壓力測試

**目標**：創建更具挑戰性的測試圖片，評估演算法極限

**主要挑戰**：
1. 邊緣模糊化（高斯模糊 sigma=2.5）
2. 正確的垂直邊緣檢測
3. 橢圓形缺陷（更真實）
4. 需要更高的缺陷強度（1.4-2.5×）

**關鍵突破**：
- 使用梯度分析準確檢測垂直邊緣
- 區分 Dark→Bright 和 Bright→Dark 邊緣
- 在正確的邊緣位置放置缺陷

**最新檔案**：
- `sem_defect_detector_v1.py` - 整合版檢測器
- `create_final_blurred_defects.py` - 創建模糊邊緣缺陷
- `final_blurred_defects.jpg` - 壓力測試圖片
- `final_blurred_defects_annotated.png` - 標註版本

**中間檔案**：
所有中間版本已移至 `old_versions/` (12-24)